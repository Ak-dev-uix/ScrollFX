/*!
 *  ScrollFX.js v1.0.0
 *  Cinematic Scroll-Controlled Frame Animation Framework
 *  -----------------------------------------------------
 *  Author   : Ak.Dev
 *  Website  : https://ak-folio.netlify.app
 *  GitHub   : https://github.com/Ak-dev-uix/ScrollFX
 *  License  : MIT
 *  Created  : November 2025
 *  Powered  : GSAP + ScrollTrigger
 *
 *  Description:
 *  ScrollFX lets you create ultra-smooth, cinematic frame-by-frame
 *  scroll animations with just a few HTML data attributes.
 *  Lightweight. Responsive. Developer Friendly.
 *
 *  Â© 2025 Ak.Dev | All rights reserved.
 */

gsap.registerPlugin(ScrollTrigger);

// ===== Setup =====
const section = document.querySelector('.scroll-section');
const canvas = section.querySelector('canvas');
const ctx = canvas.getContext('2d');

const folder = section.dataset.folder;
const name = section.dataset.name;
const frames = parseInt(section.dataset.frames);
const ext = section.dataset.ext || 'jpg';
const length = parseInt(section.dataset.length) || 3;

const pad = num => String(num).padStart(length, '0');
const images = [];
let loaded = 0;
let currentFrame = 0;

// ----- Preload Images -----
function preload() {
  for (let i = 1; i <= frames; i++) {
    const img = new Image();
    img.src = `${folder}/${name}${pad(i)}.${ext}`;
    img.onload = () => {
      loaded++;
      if (loaded === 1) {
        resizeCanvas();
        drawFrame(1);
      }
    };

    images.push(img);
  }
}

// ----- Draw Frame -----
function drawFrame(index) {
  const img = images[index];
  if (!img) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
}

// ----- Resize Canvas -----
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  drawFrame(Math.floor(currentFrame));
}
window.addEventListener('resize', resizeCanvas);

// ===== Scroll Animation (GSAP + ScrollTrigger) =====
function initScrollAnimation() {
  gsap.to({ frame: 0 }, {
    frame: frames - 1,
    snap: "frame",
    ease: "none",
    scrollTrigger: {
      trigger: section,
      start: "top top",
      end: "bottom bottom",
      scrub: 1,
    },
    onUpdate: function() {
      currentFrame = Math.floor(this.targets()[0].frame);
      drawFrame(currentFrame);
    }
  });
}

// ===== Initialize =====
preload();
resizeCanvas();
setTimeout(() => drawFrame(1), 100);
initScrollAnimation();
